<div class="container">
  <h1 class="page-title">Uçuş Arama</h1>

  <app-card header="Uçuş Ara" styleClass="search-card">
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <div class="grid">
        <div class="col-12 md:col-6">
          <div class="field">
            <label for="origin">Nereden</label>
            <app-input-text
              id="origin"
              type="text"
              formControlName="origin"
              placeholder="Kalkış şehri (örn: IST)"
              styleClass="w-full"
            />
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="destination">Nereye</label>
            <app-input-text
              id="destination"
              type="text"
              formControlName="destination"
              placeholder="Varış şehri (örn: AMS)"
              styleClass="w-full"
            />
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="startDate">Başlangıç Tarihi</label>
            <app-date-picker
              id="startDate"
              formControlName="startDate"
              dateFormat="dd/mm/yy"
              placeholder="Tarih seçin"
            />
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="endDate">Bitiş Tarihi</label>
            <app-date-picker
              id="endDate"
              formControlName="endDate"
              dateFormat="dd/mm/yy"
              placeholder="Tarih seçin"
            />
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="maxPrice">Maksimum Fiyat (TL)</label>
            <app-input-number
              id="maxPrice"
              formControlName="maxPrice"
              placeholder="Fiyat limiti"
              [min]="0"
              currency="TRY"
              mode="currency"
            />
          </div>
        </div>

        <div class="col-12 md:col-6">
          <div class="field">
            <label for="limit">Sonuç Sayısı</label>
            <app-input-number
              id="limit"
              formControlName="limit"
              placeholder="Kaç sonuç"
              [min]="1"
              [max]="100"
            />
          </div>
        </div>
      </div>

      <div class="search-actions">
        <p-button
          type="submit"
          label="Uçuş Ara"
          icon="pi pi-search"
          [loading]="loading"
          [disabled]="searchForm.invalid"
          styleClass="mr-2"
        />
        <p-button
          type="button"
          label="En Ucuz Günler"
          icon="pi pi-chart-line"
          severity="secondary"
          [loading]="loadingCheapest"
          [disabled]="!searchForm.get('origin')?.value || !searchForm.get('destination')?.value"
          (click)="getCheapestDays()"
        />
      </div>
    </form>
  </app-card>

  <!-- Search Results -->
  <app-card *ngIf="searchResults.length > 0" header="Arama Sonuçları" styleClass="results-card">
    <p-table [value]="searchResults" [paginator]="true" [rows]="10">
      <ng-template pTemplate="header">
        <tr>
          <th>Fiyat</th>
          <th>Tarih</th>
          <th>Rota</th>
          <th>Sağlayıcı</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-flight>
        <tr>
          <td>
            <span class="price">{{ flight.price | currency:'TRY':'symbol':'1.0-0' }}</span>
          </td>
          <td>{{ flight.departureDate | date:'dd/MM/yyyy' }}</td>
          <td>{{ flight.route.origin }} → {{ flight.route.destination }}</td>
          <td>{{ flight.provider.name }}</td>
        </tr>
      </ng-template>
    </p-table>
  </app-card>

  <!-- Cheapest Days Chart -->
  <app-card *ngIf="cheapestDaysData" header="En Ucuz Günler" styleClass="chart-card">
    <p-chart type="line" [data]="cheapestDaysData" [options]="chartOptions"></p-chart>
  </app-card>

  <!-- Loading -->
  <div *ngIf="loading || loadingCheapest" class="loading-container">
    <p-progressSpinner></p-progressSpinner>
  </div>

  <!-- Error Message -->
  <p-message
    *ngIf="errorMessage"
    severity="error"
    [text]="errorMessage"
    styleClass="w-full mt-3"
  />
</div>
